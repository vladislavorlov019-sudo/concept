# B1) Концепт №1: Архитектура сбора и обработки данных (Data Engineering)

## 1. Введение
Данный концепт описывает технологический фундамент системы автоматизированной отчетности. Основной задачей уровня Data Engineering является обеспечение бесперебойной поставки, очистки и валидации данных из разнородных источников в единое аналитическое хранилище. 
Мы уходим от ручной обработки Excel-файлов к промышленному конвейеру данных (Data Pipeline).

## 2. Схема потоков данных (Data Flow)
Архитектура строится по принципу **ELT (Extract - Load - Transform)** с усиленным модулем препроцессинга.

### 2.1. Источники данных (Sources)
Система агрегирует данные из трех контуров, имеющих разную структуру:
* **ERP-контур (1С:Предприятие):** Источник финансовых транзакций, данных о себестоимости и складских остатках. Формат доступа: OData / API.
* **CRM-контур (Отраслевая CRM):** Источник данных о клиентах, сделках, статусах воронки продаж и активности менеджеров. Формат доступа: REST API (JSON).
* **Плановый контур (Локальные файлы):** Данные о планах продаж и бюджетах, которые формируются финансовым отделом. Формат: Excel/CSV (парсинг через сетевую папку).

### 2.2. Слой интеграции и оркестрации (Middleware)
В качестве интеграционной шины выбрана платформа **n8n**. Она выполняет роль диспетчера, который запускает процессы по расписанию (например, каждые 15 минут) или по триггерам (появление нового файла плана).

**Ключевой элемент — Модуль Data Quality (Контроль качества):**
В отличие от старого подхода, данные не попадают в отчет "как есть". Реализован промежуточный шлюз валидации:
1.  **Проверка типов:** Дата должна быть датой, сумма — числом.
2.  **Проверка дублей:** Исключение задвоения транзакций при повторной выгрузке.
3.  **Логический контроль:** Система автоматически блокирует загрузку аномалий (например, отрицательная маржа или дата отгрузки раньше даты заказа) и отправляет алерт администратору.

### 2.3. Слой хранения
Для хранения выбран **ClickHouse**. Это колоночная СУБД, оптимизированная для аналитических запросов.
* *Обоснование:* ClickHouse обеспечивает сжатие данных (экономия диска) и мгновенную скорость выборки (SELECT) на больших объемах, где Excel и обычные SQL-базы "тормозят".
* *Структура:* Используется схема "Звезда" или "Снежинка", где есть таблицы фактов (транзакции) и таблицы измерений (справочники клиентов, товаров).

## 3. Технологические ограничения и решения
| Проблема AS-IS | Решение в Концепте №1 |
| :--- | :--- |
| Медленная работа "тяжелых" Excel-файлов | Перенос вычислений на сторону сервера БД (ClickHouse). |
| Ошибки ручного ввода | Автоматическая валидация (Data Quality Check) до загрузки в базу. |
| Рассинхрон справочников | Единая нормализация названий клиентов и номенклатуры на этапе ETL. |

## 4. Результат реализации Концепта №1
Результатом является создание **"Доверенного слоя данных"**. Это структурированный массив информации, очищенный от ошибок и дублей, обновляемый автоматически без участия человека. Это фундамент, на котором строится вся дальнейшая аналитика.
