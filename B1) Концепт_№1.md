# B1) Концепт №1: Техническая архитектура системы сбора и обработки данных

## 1. Паспорт проекта

| Параметр | Значение |
| :--- | :--- |
| **Наименование системы** | Единая автоматизированная система аналитической отчетности (ЕАСАО) |
| **Тип проекта** | Data Engineering / Business Intelligence |
| **Заказчик** | Коммерческий департамент производственной компании |
| **Архитектурный стиль** | Modern Data Stack (ELT + MPP Database) |
| **Стек технологий** | **ETL:** n8n / Power Automate<br>**DWH:** ClickHouse<br>**BI:** Yandex DataLens<br>**Code:** SQL (ClickHouse dialect), JavaScript (функции n8n) |
| **Ключевой принцип** | Отказ от ручных операций в пользу конвейерной обработки данных (Data Pipeline) |

---

## 2. Краткое описание проекта
Проект представляет собой разработку централизованной экосистемы для управления корпоративными данными. Система замещает децентрализованный ручной сбор отчетности ("Excel-менеджмент") на автоматизированный промышленный конвейер.
Решение объединяет данные из транзакционных систем (1С, CRM) и файловых источников, проводит их очистку, нормализацию и обогащение, после чего предоставляет готовые витрины данных для визуализации.

---

## 3. Нормативно-правовая и методическая основа
Проектирование и разработка системы осуществляются в соответствии с:
1.  **DAMA-DMBOK 2 (Data Management Body of Knowledge)** — в части управления качеством данных (Data Quality) и мастер-данными (MDM).
2.  **ГОСТ 34.601-90** — в части стадий создания автоматизированных систем (адаптировано).
3.  **Федеральный закон № 152-ФЗ "О персональных данных"** — в части обработки данных сотрудников (расчет KPI).
4.  **Внутренние регламенты компании** — Политика информационной безопасности и Положение о коммерческой тайне (NDA).

---

## I. Общие положения
1.1. Система предназначена для автоматизации процессов сбора, хранения, обработки и выдачи аналитической информации.
1.2. Пользователями системы являются руководство компании, начальники отделов и линейные менеджеры.
1.3. Система функционирует в режиме **Near Real-Time** (обновление данных с задержкой не более 15 минут) для оперативных отчетов и Batch (ежесуточно) для стратегических.

---

## II. Основания и предпосылки разработки
Необходимость создания Системы обусловлена критическими недостатками текущей модели управления данными (AS-IS):

1.  **Гетерогенность ландшафта:** Данные распределены по изолированным системам ("информационным колодцам"). Отсутствует единый идентификатор сквозных бизнес-процессов.
2.  **Низкое качество НСИ (Нормативно-справочной информации):** В разных системах одна и та же номенклатура или контрагент записаны по-разному (напр., *"Сыр Российский"* vs *"Рос. сыр 50%"*). Это делает невозможным автоматическое сведение баланса без ручного маппинга.
3.  **Технологический предел:** Объем исторических данных превысил возможности табличных процессоров (Excel), что приводит к невозможности оперативного Drill-down анализа.

---

## III. Цели, задачи и показатели

### 3.1. Цели
Создание "Единой версии правды" (Single Source of Truth) — доверенного слоя данных, где исключены дубли, ошибки ввода и расхождения методологий расчета.

### 3.2. Задачи
1.  Настроить идемпотентные потоки данных (Pipelines) из источников.
2.  Реализовать алгоритмы **Data Quality**, блокирующие попадание некорректных данных в отчеты.
3.  Внедрить лайт-версию **MDM (Master Data Management)** для приведения справочников к эталонному виду.
4.  Обеспечить историческое хранение данных в колоночной СУБД.

### 3.3. Целевые показатели (KPI проекта)
* **Time-to-Report:** Сокращение времени подготовки сводного отчета с 8 часов до 30 секунд.
* **Data Integrity:** 100% соответствие данных в витрине и источнике (автоматическая сверка).
* **Availability:** Доступность сервиса 99.9% в рабочее время.

---

## IV. Архитектурное обоснование

Для реализации выбрана архитектура **ELT (Extract-Load-Transform)** с многослойным хранением данных (Medallion Architecture).

### 4.1. Слой интеграции и оркестрации (Ingestion Layer)
Используется Low-code платформа **n8n**. Реализовано два паттерна запуска процессов:
* **Scheduled Pipelines (По расписанию):** Для систем с API (1С, CRM). Инкрементальная загрузка данных (Delta Load) каждые 15-60 минут. Забираются только записи, измененные с момента последней синхронизации.
* **Event-Driven Pipelines (По событию):** Для файловых источников. Триггер `FileSystem Watcher` срабатывает мгновенно при появлении нового файла (плана/бюджета) в целевой папке. Файл валидируется и загружается, исключая простой.

### 4.2. Контроль качества и MDM (Processing Layer)
На уровне обработки решается проблема "грязных справочников".
* **Синтаксический контроль:** Проверка типов данных, обязательности полей.
* **Семантическая нормализация:** Внедрен алгоритм токенизации наименований. Система разбирает неструктурированные строки ("Сыр Гауда 45% брус") на атрибуты (*Категория, Жирность, Форм-фактор*) и сопоставляет их с эталонным справочником через таблицы маппинга. Это позволяет вести аналитику не по тысячам разрозненных названий, а по чистым продуктовым категориям.

### 4.3. Слой хранения (Storage Layer - ClickHouse)
Выбор колоночной СУБД ClickHouse обусловлен необходимостью высокой скорости чтения (OLAP-сценарии). Организация данных трехуровневая:
1.  **L1 Raw (Bronze):** "Сырые" данные в формате JSON/String. Хранят историю изменений, позволяют перезапустить расчеты при ошибке логики. Используется движок `MergeTree`.
2.  **L2 Core (Silver):** Нормализованный слой. Реализована классическая **Схема "Звезда" (Star Schema)**:
    * *Таблицы фактов:* Транзакции, перемещения, логи.
    * *Таблицы измерений:* Справочники клиентов, товаров, сотрудников.
3.  **L3 Marts (Gold):** Витрины данных для BI. Используются **Materialized Views** (Материализованные представления). На этом уровне происходит денормализация: данные заранее "джойнятся" в широкие плоские таблицы, оптимизированные для мгновенной отдачи в Yandex DataLens.

---

## V. Информационная безопасность

5.1. **Сетевой периметр:** База данных и ETL-сервер размещены во внутреннем контуре (VPN/Private Network), порты наружу закрыты. Доступ к DataLens осуществляется по HTTPS.
5.2. **Ролевая модель (RBAC):**
* *Admin:* Полный доступ к БД и ETL.
* *Service User:* Техническая учетная запись для n8n (только `INSERT/SELECT`).
* *Business User:* Доступ только к визуализации (Read Only) через интерфейс BI.
5.3. **Обезличивание:** В слое витрин персональные данные сотрудников (для зарплатных отчетов) хешируются или скрываются, доступ к ним регулируется RLS (Row Level Security).

---

## VI. Условия и мероприятия по созданию системы

### 6.1. Требования к инфраструктуре
Для развертывания используется контейнеризация (Docker).
* **Сервер БД:** CPU 4 cores, RAM 16GB, SSD 500GB (ClickHouse).
* **Сервер приложений:** CPU 2 cores, RAM 4GB (n8n worker).

### 6.2. Этапы реализации
1.  **Прототипирование:** Развертывание стека, настройка коннекторов к API 1C и CRM. Тестовая выгрузка.
2.  **Проектирование модели данных:** Создание схем таблиц (DDL), настройка справочников MDM.
3.  **Разработка ETL:** Настройка сценариев оркестрации, валидации и обработки ошибок.
4.  **Визуализация:** Сборка дашбордов и настройка прав доступа.
5.  **Опытная эксплуатация:** Параллельная работа старой и новой системы, сверка цифр.

---

## VII. Оценка эффективности

Внедрение системы обеспечивает качественный скачок в управлении предприятием:
1.  **Экономический эффект:** Высвобождение до 20% рабочего времени руководителя отдела продаж (эквивалент ФОТ), которое ранее тратилось на техническую рутину.
2.  **Управленческий эффект:** Исключение фактора "слепых зон". Возможность принимать решения на основе данных (Data-Driven), а не интуиции.
3.  **Технический эффект:** Переход на масштабируемую архитектуру. Рост объема данных в 10 раз не приведет к падению производительности отчетов, в отличие от Excel.
